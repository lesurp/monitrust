<!doctype html>
<head>
    <title>MoniTRust</title>
    <link rel="manifest" href="manifest.json" />
</head>
<body>
    <button id="start">Start monitoring!</button>
</body>
<script charset="utf-8">
function notifyStorage(storageLeft, storageThreshold) {
    const notifTitle = `Your storage is running low: ${Math.floor(storageLeft * 100)}%`;
    const options = {};
    new Notification(notifTitle, options);
}

async function checkStorage() {
    const request = await fetch("./df");
    const requestBody = await request.text();
    const storageLeft = parseFloat(requestBody);
    const storageThreshold = 0.5;
    if (storageLeft < storageThreshold)
    {
      Notification.requestPermission().then((result) => {
        if (result === "granted") {
          notifyStorage(storageLeft, storageThreshold);
        }
      });
    }
    const timeoutSec = 60 * 30;
    setTimeout(checkStorage, timeoutSec * 1000);
}

document.getElementById("start").addEventListener("click", () => {
    checkStorage();
});
</script>
